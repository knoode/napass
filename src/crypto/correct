import base64
from cryptography.fernet import Fernet
import tomllib  # Python 3.11+

key = Fernet.generate_key()
fernet = Fernet(key)

# Исходное значение
data = {"username": "rawbyte92", "pwd": "<?9Dz69j*A\\"}

# Шифруем и кодируем значения в base64
encrypted = {
    k: base64.b64encode(fernet.encrypt(v.encode())).decode()
    for k, v in data.items()
}

# Сохраняем в строку TOML
toml_string = "[XSS]\n"
for k, v in encrypted.items():
    toml_string += f'{k} = "{v}"\n'

# ===== Потом при чтении =====

# Парсим обратно
parsed = tomllib.loads(toml_string)

# Декодируем и расшифровываем
decrypted = {
    k: fernet.decrypt(base64.b64decode(v)).decode()
    for k, v in parsed["XSS"].items()
}

print(decrypted)
